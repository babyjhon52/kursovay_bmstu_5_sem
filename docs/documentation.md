# Система анализа МРТ-снимков головного мозга

## Введение

Система анализа МРТ-снимков головного мозга - это интеллектуальное приложение для автоматической сегментации опухолей на медицинских изображениях. Система использует глубокое обучение на основе архитектуры UNet с энкодером EfficientNet для точного определения областей опухолей на МРТ-снимках.

## Архитектура системы

### Основные модули

| Модуль | Описание |
|--------|----------|
| config.py | Конфигурация системы: трансформации данных, настройки устройства |
| security.py | Безопасность: шифрование данных, контроль доступа по ролям |
| utils.py | Утилиты: функции для работы с пользователями, метрики качества |
| models.py | Модели: UNet архитектура, датасет для медицинских изображений |
| data_management.py | Управление данными: история сегментаций, резервные копии |
| monitoring.py | Мониторинг: отслеживание системных ресурсов |
| threads.py | Потоки: асинхронная сегментация и обучение моделей |
| gui/ | Интерфейс: панели для администратора, врача и исследователя |

## Установка и запуск

### 1. Установка зависимостей

Установите все необходимые зависимости из файла requirements.txt:

```bash
pip install -r requirements.txt
```

### 2. Запуск приложения

Запустите приложение из корневой директории проекта:

```bash
python main.py
```

## Роли пользователей

| Роль | Описание | Доступные функции |
|------|----------|-------------------|
| Администратор | Полный доступ к системе | Управление пользователями, мониторинг, резервные копии |
| Врач | Клиническая работа | Сегментация изображений, подтверждение результатов, история |
| Исследователь | Разработка моделей | Обучение моделей, анализ результатов, эксперименты |

### Учетные данные по умолчанию

- Администратор: логин `admin`, пароль `admin123`
- Врач: логин `d`, пароль `1`
- Исследователь: логин `r`, пароль `1`

## Основные функции

### Сегментация изображений

Система позволяет загружать МРТ-снимки и автоматически выполнять сегментацию опухолей. Используется предобученная модель на основе UNet с энкодером EfficientNet-B4. Результаты сегментации отображаются с наложением маски на исходное изображение.

Процесс работы:

1. Загрузка МРТ-снимка (поддерживаются форматы: TIF, TIFF, PNG, JPG, JPEG)
2. Автоматическая сегментация с использованием обученной модели
3. Отображение результата с визуализацией маски
4. Подтверждение результата врачом
5. Сохранение в историю с метаданными

### Обучение моделей

Исследователи могут обучать новые модели на собственных датасетах. Система поддерживает настройку параметров обучения:

- Количество эпох
- Размер батча
- Скорость обучения (learning rate)
- Выбор предобученной модели для fine-tuning

Формат датасета:

- Папка с подпапками пациентов
- В каждой подпапке: изображение и маска в формате `[имя]_mask.tif`

Результаты обучения сохраняются с метриками качества (Dice, IoU, Loss).

### Управление данными

Все сегментации сохраняются в зашифрованном виде с метаданными:

- ID сегментации
- ID пользователя
- Временная метка
- Информация о модели
- Метрики качества
- Статус подтверждения

Система поддерживает:

- Создание резервных копий данных пользователей и моделей
- Восстановление из резервных копий
- Экспорт результатов в зашифрованном JSON формате
- История всех выполненных сегментаций

### Безопасность

Система использует:

- Шифрование данных с использованием Fernet (симметричное шифрование)
- Контроль доступа на основе ролей (RBAC)
- Зашифрованное хранение паролей
- Защиту от несанкционированного доступа к функциям

## Структура проекта

```
LGG_SEGM/
├── main.py                 # Точка входа в приложение
├── src/                    # Исходный код
│   ├── core/              # Основные модули
│   │   ├── config.py      # Конфигурация
│   │   ├── security.py   # Безопасность
│   │   ├── utils.py       # Утилиты
│   │   ├── models.py      # Модели ML
│   │   ├── data_management.py  # Управление данными
│   │   ├── monitoring.py  # Мониторинг
│   │   └── threads.py     # Потоки
│   └── gui/               # Интерфейс
│       ├── dialogs.py     # Диалоги
│       ├── main_window.py # Главное окно
│       ├── models.py       # Модели GUI
│       └── panels.py       # Панели
├── tests/                  # Тесты
│   ├── test_security.py
│   ├── test_utils.py
│   ├── test_data_management.py
│   ├── test_monitoring.py
│   ├── test_models.py
│   └── test_config.py
├── data/                   # Данные
│   ├── backups/           # Резервные копии
│   ├── models/            # Модели ML
│   ├── segmentations/    # Сегментации
│   ├── users/            # Пользователи
│   └── datasets/         # Датасеты для обучения
└── docs/                   # Документация
```

## Технические детали

### Модель сегментации

- Архитектура: UNet++ с энкодером EfficientNet-B4
- Входные данные: изображения 256x256 пикселей в RGB формате
- Выходные данные: бинарная маска сегментации
- Функция потерь: BCEWithLogitsLoss
- Оптимизатор: Adam

### Метрики качества

Система использует:

- Коэффициент Dice для оценки качества сегментации
- IoU (Intersection over Union) для дополнительной оценки
- Функция потерь для мониторинга процесса обучения

### Трансформации данных

Для обучения используются аугментации:

- Повороты и отражения
- Изменения яркости и контраста
- Эластичные трансформации
- Grid distortion
- Оптические искажения
- Dropout для регуляризации

Для валидации применяются только базовые трансформации:

- Изменение размера до 256x256
- Нормализация по ImageNet статистике

### Системные требования

- Python 3.8+
- PyTorch 2.0+
- CUDA (опционально, для GPU ускорения)
- Минимум 8GB RAM
- Рекомендуется GPU с поддержкой CUDA для обучения моделей

## Тестирование

Система включает набор тестов на pytest для проверки всех основных функций.

### Запуск тестов

```bash
# Все тесты
pytest tests/ -v

# Конкретный файл
pytest tests/test_security.py -v

# С покрытием кода
pytest tests/ --cov=. --cov-report=html
```

### Структура тестов

- test_security.py - Тесты модуля безопасности
- test_utils.py - Тесты утилит
- test_data_management.py - Тесты управления данными
- test_monitoring.py - Тесты мониторинга
- test_models.py - Тесты моделей ML
- test_config.py - Тесты конфигурации

## API и интерфейсы

### Классы основных модулей

#### EncryptionManager

Управление шифрованием данных:

- `encrypt_data(data)` - шифрование данных
- `decrypt_data(encrypted_data)` - дешифрование данных
- `encrypt_password(password)` - шифрование пароля
- `decrypt_password(encrypted_password)` - дешифрование пароля

#### SegmentationHistory

Управление историей сегментаций:

- `save_segmentation()` - сохранение сегментации
- `get_user_history(user_id)` - получение истории пользователя
- `get_segmentation_by_id(seg_id)` - получение по ID
- `delete_segmentation(seg_id)` - удаление сегментации

#### BackupManager

Управление резервными копиями:

- `create_backup(data)` - создание резервной копии
- `load_latest_backup()` - загрузка последней копии
- `list_backups()` - список всех копий
- `restore_backup(backup_path)` - восстановление из копии

#### SystemMonitor

Мониторинг системных ресурсов:

- `get_stats()` - получение статистики (CPU, RAM, GPU, Disk)

## Заключение

Система анализа МРТ-снимков предоставляет комплексное решение для автоматической сегментации опухолей головного мозга. Система обеспечивает безопасность данных, удобный интерфейс для различных ролей пользователей и возможность обучения собственных моделей.
